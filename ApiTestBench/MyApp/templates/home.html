<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
</head>
<body>
<h3>&nbsp;您的请求记录：</h3>
<div id="home_log_plan" style="padding-left: 20px;overflow-y: auto;width: 320px">
    {% for i in home_log %}
        <a href="javascript:home_log_show('{{ i.id }}')" class="log"> 
            <span style="font-size: small;color: black">{{ i.api_method }}</span> - 
            {{ i.api_host }}{{ i.api_url }}</a><br>
    {% endfor %}
</div>
<div id="shu" style="width: 2px;background-color: #262c2c;position: absolute;top: 70px;left:340px;">
    &nbsp;
</div>
<div style="position: absolute;top: 100px;left: 350px;width: -webkit-calc(100% - 400px);">
<ul class="nav navbar-nav" style="width: 99%">
        <li>
            <select id="ts_method" style="height: 40px;width: 99%" class="form-control">
                <option value="get">GET</option>
                <option value="post">POST</option>
                <option value="put">PUT</option>
                <option value="delete">DELETE</option>
            </select>
        </li>

        <li style="width: -webkit-calc(100% - 225px)">
            <input id="ts_url" style="color: black;padding-left: 10px;width: 99%;height: 40px;" type="text"
                   placeholder="url: /example/test" value="">
        </li>

        <li>
            <button onclick="ts_send()" type="button" style="height: 40px;width: 120px;" class="btn btn-default">
                <span style="font-size: large">Send</span></button>
        </li>

    </ul>

    <br><br><br>
    <ul class="nav navbar-nav" style="width: 99%">
        <li style="width: -webkit-calc(100% - 63px)">
            <input id="ts_host" style="color: black;padding-left: 10px;width: 99%; height: 40px;" type="text"
                   placeholder="host: http(s)://www.example.com" value="">
        </li>
        <li>
            <button type="button" style="height: 40px;width: 60px;" class="btn btn-default"><span>Clear</span></button>
        </li>
    </ul>

    <br><br><br>
    <ul class="nav navbar-nav" style="width: 99%">
        <li style="width: -webkit-calc(100% - 63px)">
            <input id="ts_header" style="color: black;padding-left: 10px;width: 99%; height: 40px;" type="text"
                   placeholder='header: {"Content-Type":"application/json"}' value="">
        </li>
        <li>
            <button type="button" style="height: 40px;width: 60px;" class="btn btn-default"><span>Clear</span></button>
        </li>
    </ul>

    <br><br><br>
    <ul id="myTab" class="nav nav-tabs">
        <li class="active"><a id="click_none" href="#none" data-toggle="tab">none</a></li>
        <li><a href="#form-data" data-toggle="tab">form-data</a></li>
        <li><a href="#x-www-form-urlencoded" data-toggle="tab">x-www-form-urlencoded</a></li>
        <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">raw<b class="caret"></b></a>
            <ul class="dropdown-menu" role="menu" aria-labelledby="myTabDrop1">
                <li><a href="#Text" tabindex="-1" data-toggle="tab">Text</a></li>
                <li><a href="#JavaScript" tabindex="-1" data-toggle="tab">JavaScript</a></li>
                <li><a href="#Json" tabindex="-1" data-toggle="tab">Json</a></li>
                <li><a href="#Html" tabindex="-1" data-toggle="tab">Html</a></li>
                <li><a href="#Xml" tabindex="-1" data-toggle="tab">Xml</a></li>
            </ul>
        </li>
        <li><a href="#response" data-toggle="tab">返回体</a></li>
    </ul>
    <div id="myTabContent" class="tab-content">
        <div class="tab-pane fade in active" id="none" style="text-align: center; color: grey">
            <h3>这个请求将不会携带任何请求体</h3>
            <h5>This request will not carry any request-body</h5>
        </div>
        <div class="tab-pane fade" id="form-data">
            <div class="table-responsive" style="width: 98%;color: black">
                <table class="table table-bordered table-striped" id="mytable" style="background-color:white">
                    <thead style="color: #337ab7;font-size: x-small">
                    <tr>
                        <td style="width: 30%">Key</td>
                        <td style="width: 50%">Value</td>
                    </tr>
                    </thead>
                    <tbody id="mytbody">
                    <tr>
                        <td></td>
                        <td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <button class="btn btn-default" id="add"><i class="fa fa-plus"></i> 添加新参数</button>
            <script>
                window.jQuery || document.write('<script src="/static/201801271505/js/jquery-1.11.0.min.js"><\/script>')
            </script>
            <script type="text/javascript" src="/static/201801271505/js/bootstable.js"></script>
        </div>
        <div class="tab-pane fade" id="x-www-form-urlencoded">
            <div class="table-responsive" style="width: 98%;color: black">
                <table class="table table-bordered table-striped" id="mytable2" style="background-color:white">
                    <thead style="color: #337ab7;font-size: x-small">
                    <tr>
                        <td style="width: 30%">Key</td>
                        <td style="width: 50%">Value</td>
                    </tr>
                    </thead>
                    <tbody id="mytbody2">
                    <tr>
                        <td></td>
                        <td></td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <button class="btn btn-default" id="add2"><i class="fa fa-plus"></i> 添加新参数</button>
            <script>
                window.jQuery || document.write('<script src="/static/201801271505/js/jquery-1.11.0.min.js"><\/script>')
            </script>
            <script type="text/javascript" src="/static/201801271505/js/bootstable.js"></script>
        </div>
        <div class="tab-pane fade" id="Text">
            <textarea name="" id="raw_Text" style="color: black;width: 98%;height: 300px"></textarea>
        </div>
        <div class="tab-pane fade" id="JavaScript">
            <textarea name="" id="raw_JavaScript" style="color: black;width: 98%;height: 300px"></textarea>
        </div>
        <div class="tab-pane fade" id="Json">
            <textarea name="" id="raw_Json" style="color: black;width: 98%;height: 300px"></textarea>
        </div>
        <div class="tab-pane fade" id="Html">
            <textarea name="" id="raw_Html" style="color: black;width: 98%;height: 300px"></textarea>
        </div>
        <div class="tab-pane fade" id="Xml">
            <textarea name="" id="raw_Xml" style="color: black;width: 98%;height: 300px"></textarea>
        </div>
        <div class="tab-pane fade" id="response">
            <textarea name="" id="ts_response_body" disabled="disabled" style="color: black;width: 98%;height: 300px"></textarea>
        </div>
    </div>
    <br>
</div>
<script>
    var h = document.documentElement.clientHeight;
    document.getElementById('shu').style.height = (h-85).toString() + 'px';
    //document.getElementById('home_log_plan').style.height = (h-85).toString() + 'px';
</script>
<script>
    $('#mytable').SetEditable({
            $addButton: $('#add'),
        });
    $('#mytable2').SetEditable({
            $addButton: $('#add2'),
        });
    function ts_send() {
        var ts_method = document.getElementById('ts_method').value;
        var ts_url = document.getElementById('ts_url').value;
        var ts_host = document.getElementById('ts_host').value;
        var ts_header = document.getElementById('ts_header').value;
        if(ts_url == ''){alert('请输入url！');return}
        if(ts_host == ''){alert('请输入host！');return}
        if(ts_host.slice(0,7) != 'http://' && ts_host.slice(0,8) != 'https://'){
            alert('host必须以http://或https://开头！');return
        }
        if(ts_header != ''){
            try{
                JSON.parse(ts_header)
            }catch (e) {
                alert('header请求头不合符json规范！');
                return
            }
        }
        var ts_body_method = $('ul#myTab li[class="active"]')[0].innerText;
        if(ts_body_method == 'none'){
            var ts_api_body = '';
        }
        if(ts_body_method == 'form-data'){
            var ts_api_body = [];
            var tbody_ = $("table#mytable tbody")[0];
            var trlist = tbody_.children;
            for(var i=0;i<trlist.length;i++) {
                var tdarr = trlist[i].children;
                var key = tdarr[0].innerText;
                var value = tdarr[1].innerText;
                ts_api_body.push([key, value]);
            }
            ts_api_body = JSON.stringify(ts_api_body);

        }
        if(ts_body_method == 'x-www-form-urlencoded'){
            var ts_api_body = [];
            var tbody_ = $("table#mytable2 tbody")[0];
            var trlist = tbody_.children;
            for(var i=0;i<trlist.length;i++) {
                var tdarr = trlist[i].children;
                var key = tdarr[0].innerText;
                var value = tdarr[1].innerText;
                ts_api_body.push([key, value]);
            }
            ts_api_body = JSON.stringify(ts_api_body);

        }
        if(ts_body_method == 'Text'){
            var ts_api_body = document.getElementById('raw_Text').value;

        }
        if(ts_body_method == 'JavaScript'){
            var ts_api_body = document.getElementById('raw_JavaScript').value;
        }
        if(ts_body_method == 'Json'){
            var ts_api_body = document.getElementById('raw_Json').value;
        }
        if(ts_body_method == 'Html'){
            var ts_api_body = document.getElementById('raw_Html').value;
        }
        if(ts_body_method == 'Xml'){
            var ts_api_body = document.getElementById('raw_Xml').value;
        }
        $.get('/Api_send_home/', {
            'ts_method':ts_method,
            'ts_url':ts_url,
            'ts_host':ts_host,
            'ts_header':ts_header,
            'ts_body_method':ts_body_method,
            'ts_api_body':ts_api_body
        },function (ret) {
            $("li a[href=#response]").click();
            document.getElementById('ts_response_body').value = ret;
        })
    }
</script>
</body>
</html>